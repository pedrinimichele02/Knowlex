<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}KnowLex - Il Tuo Hub di Conoscenza Legale{% endblock %}</title>
    {% load static %}
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static 'css/main.css' %}" rel="stylesheet">
    <!-- Hero Colors Override CSS -->
    <link href="{% static 'css/hero-colors-override.css' %}" rel="stylesheet">
    
    <meta name="description" content="{% block description %}KnowLex - La tua destinazione premium per approfondimenti legali, notizie e analisi esperte. Rimani aggiornato con la copertura completa del diritto commerciale, privato e del lavoro.{% endblock %}">
    
    <!-- SEO Meta Tags -->
    <meta name="keywords" content="{% block keywords %}notizie legali, diritto commerciale, diritto privato, diritto del lavoro, avvocati, consulenza legale, normative, giurisprudenza, italia{% endblock %}">
    <meta name="author" content="KnowLex">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="{% block canonical %}{{ request.build_absolute_uri }}{% endblock %}">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{% block og_title %}KnowLex - Il Tuo Hub di Conoscenza Legale{% endblock %}">
    <meta property="og:description" content="{% block og_description %}KnowLex - La tua destinazione premium per approfondimenti legali, notizie e analisi esperte. Rimani aggiornato con la copertura completa del diritto commerciale, privato e del lavoro.{% endblock %}">
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:site_name" content="KnowLex">
    <meta property="og:locale" content="it_IT">
    {% block og_image %}<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{% load static %}{% static 'images/knowlex-og-image.png' %}">{% endblock %}
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}KnowLex - Il Tuo Hub di Conoscenza Legale{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}KnowLex - La tua destinazione premium per approfondimenti legali, notizie e analisi esperte.{% endblock %}">
    {% block twitter_image %}<meta name="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{% load static %}{% static 'images/knowlex-og-image.png' %}">{% endblock %}
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "KnowLex",
      "description": "Il tuo hub premium di conoscenza legale per notizie, analisi e approfondimenti legali in Italia.",
      "url": "{{ request.scheme }}://{{ request.get_host }}",
      "publisher": {
        "@type": "Organization",
        "name": "KnowLex",
        "url": "{{ request.scheme }}://{{ request.get_host }}"
      },
      "potentialAction": {
        "@type": "SearchAction",
        "target": "{{ request.scheme }}://{{ request.get_host }}/search?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    
    <!-- Theme Preload Script (Prevent FOUC) -->
    <script>
        // Immediately apply stored theme to prevent flash
        (function() {
            try {
                const storedTheme = localStorage.getItem('knowlex-theme-preference');
                const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                const theme = storedTheme || (systemPrefersDark ? 'dark' : 'light');
                
                if (theme === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                }
            } catch (e) {
                // Ignore localStorage errors
            }
        })();
    </script>
</head>
<body>
    <!-- Enhanced Beautiful Navigation -->
    <nav class="enhanced-navbar fixed-top">
        <div class="navbar-container">
            <div class="navbar-content">
                <!-- Brand Section -->
                <div class="navbar-brand-section">
                    <a class="enhanced-brand" href="{% url 'news:home' %}">
                        <div class="brand-icon">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <div class="brand-text-container">
                            <span class="brand-main">Know</span><span class="brand-accent">Lex</span>
                        </div>
                    </a>
                </div>

                <!-- Desktop Navigation Links -->
                <div class="navbar-links-desktop">
                    <a class="nav-link-enhanced active" href="{% url 'news:home' %}">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a class="nav-link-enhanced" href="{% url 'news:article_list' %}">
                        <i class="fas fa-newspaper"></i>
                        <span>Articoli</span>
                    </a>
                    <div class="nav-dropdown">
                        <a class="nav-link-enhanced dropdown-trigger" href="#">
                            <i class="fas fa-folder-open"></i>
                            <span>Categorie</span>
                            <i class="fas fa-chevron-down dropdown-arrow"></i>
                        </a>
                        <div class="dropdown-menu-enhanced">
                            <a class="dropdown-item-enhanced" href="{% url 'news:category_articles' 'commerciale' %}">
                                <i class="fas fa-building"></i>
                                <span>Diritto Commerciale</span>
                            </a>
                            <a class="dropdown-item-enhanced" href="{% url 'news:category_articles' 'privato' %}">
                                <i class="fas fa-users"></i>
                                <span>Diritto Civile</span>
                            </a>
                            <a class="dropdown-item-enhanced" href="{% url 'news:category_articles' 'lavoro' %}">
                                <i class="fas fa-briefcase"></i>
                                <span>Diritto del Lavoro</span>
                            </a>
                            <a class="dropdown-item-enhanced" href="{% url 'news:category_articles' 'penale' %}">
                                <i class="fas fa-gavel"></i>
                                <span>Diritto Penale</span>
                            </a>
                        </div>
                    </div>
                    <a class="nav-link-enhanced" href="{% url 'news:about_us' %}">
                        <i class="fas fa-info-circle"></i>
                        <span>Chi Siamo</span>
                    </a>
                    <a class="nav-link-enhanced" href="{% url 'news:team' %}">
                        <i class="fas fa-users"></i>
                        <span>Team</span>
                    </a>
                </div>

                <!-- Right Section with Theme Toggle -->
                <div class="navbar-actions">
                    <button class="theme-toggle-enhanced" id="themeToggle" type="button" aria-label="Cambia tema">
                        <div class="toggle-icon">
                            <i class="fas fa-moon" id="themeIcon"></i>
                        </div>
                        <span class="toggle-text d-none d-xl-inline" id="themeText">Tema Scuro</span>
                    </button>
                    
                    <!-- Mobile Menu Button -->
                    <button class="mobile-menu-btn d-lg-none" id="mobileMenuToggle" type="button" aria-label="Menu">
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                    </button>
                </div>
            </div>
        </div>

    </nav>

    <!-- Mobile Menu Overlay - FUORI DALLA NAVBAR PER FULLSCREEN -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay">
        <div class="mobile-menu-content">
            <div class="mobile-menu-header">
                <h3>Menu di Navigazione</h3>
                <button class="mobile-menu-close" id="mobileMenuClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mobile-menu-links">
                <a class="mobile-nav-link" href="{% url 'news:home' %}">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a class="mobile-nav-link" href="{% url 'news:article_list' %}">
                    <i class="fas fa-newspaper"></i>
                    <span>Tutti gli Articoli</span>
                </a>
                <div class="mobile-nav-section">
                    <h4>Categorie Legali</h4>
                    <a class="mobile-nav-link sub-link" href="{% url 'news:category_articles' 'commerciale' %}">
                        <i class="fas fa-building"></i>
                        <span>Diritto Commerciale</span>
                    </a>
                    <a class="mobile-nav-link sub-link" href="{% url 'news:category_articles' 'privato' %}">
                        <i class="fas fa-users"></i>
                        <span>Diritto Civile</span>
                    </a>
                    <a class="mobile-nav-link sub-link" href="{% url 'news:category_articles' 'lavoro' %}">
                        <i class="fas fa-briefcase"></i>
                        <span>Diritto del Lavoro</span>
                    </a>
                    <a class="mobile-nav-link sub-link" href="{% url 'news:category_articles' 'penale' %}">
                        <i class="fas fa-gavel"></i>
                        <span>Diritto Penale</span>
                    </a>
                </div>
                <a class="mobile-nav-link" href="{% url 'news:about_us' %}">
                    <i class="fas fa-info-circle"></i>
                    <span>Chi Siamo</span>
                </a>
                <a class="mobile-nav-link" href="{% url 'news:team' %}">
                    <i class="fas fa-users"></i>
                    <span>Il Nostro Team</span>
                </a>
            </div>
            <div class="mobile-menu-footer">
                <button class="theme-toggle-mobile" id="themeToggleMobile" type="button">
                    <i class="fas fa-moon" id="themeIconMobile"></i>
                    <span id="themeTextMobile">Tema Scuro</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        {% block content %}
        {% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer-theme-aware py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <h5 class="fw-bold mb-3 footer-title">
                        <i class="fas fa-graduation-cap me-2"></i>KnowLex
                    </h5>
                    <p class="footer-text">Un Hub per approfondire e rendere pi√π comprensibile il diritto.</p>
                </div>
                <div class="col-lg-4 mb-4">
                    <h6 class="fw-semibold mb-3 footer-heading">Categorie</h6>
                    <ul class="list-unstyled">
                        <li><a href="{% url 'news:category_articles' 'commerciale' %}" class="footer-link text-decoration-none">Diritto Commerciale</a></li>
                        <li><a href="{% url 'news:category_articles' 'privato' %}" class="footer-link text-decoration-none">Diritto Civile</a></li>
                        <li><a href="{% url 'news:category_articles' 'lavoro' %}" class="footer-link text-decoration-none">Diritto del Lavoro</a></li>
                        <li><a href="{% url 'news:category_articles' 'penale' %}" class="footer-link text-decoration-none">Diritto Penale</a></li>
                    </ul>
                </div>
                <div class="col-lg-4 mb-4">
                    <h6 class="fw-semibold mb-3 footer-heading">Links</h6>
                    <ul class="list-unstyled">
                        <li><a href="{% url 'news:home' %}" class="footer-link text-decoration-none">Home</a></li>
                        <li><a href="{% url 'news:article_list' %}" class="footer-link text-decoration-none">Tutti gli Articoli</a></li>
                        <li><a href="{% url 'news:about_us' %}" class="footer-link text-decoration-none">Chi Siamo</a></li>
                        <li><a href="{% url 'news:team' %}" class="footer-link text-decoration-none">Team</a></li>
                        <li><hr class="footer-divider my-2"></li>
                        <li><a href="/admin/" target="_blank" class="footer-link text-decoration-none"><i class="fas fa-user-shield me-2"></i>Admin</a></li>
                    </ul>
                </div>
            </div>
            <hr class="footer-divider">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="footer-copyright mb-0">&copy; {% now "Y" %} KnowLex. Tutti i diritti riservati.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="footer-copyright mb-0">Sviluppato con Django</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Theme Toggle Script -->
    <script src="{% static 'js/theme-toggle.js' %}"></script>
    
    <!-- Enhanced Navbar Script - Mobile menu + desktop dropdown -->
    <script src="{% static 'js/navbar.js' %}"></script>
    
    <!-- Backup Mobile Menu Script - INLINE PER SICUREZZA -->
    <script>
    // Backup mobile menu script per essere sicuri che funzioni
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üîß Backup Mobile Menu Script - Loading...');
        
        const mobileToggle = document.getElementById('mobileMenuToggle');
        const mobileOverlay = document.getElementById('mobileMenuOverlay');
        const mobileClose = document.getElementById('mobileMenuClose');
        
        console.log('Elements found:', {
            toggle: !!mobileToggle,
            overlay: !!mobileOverlay,
            close: !!mobileClose
        });
        
        if (mobileToggle && mobileOverlay) {
            mobileToggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('üì± Mobile menu toggle clicked!');
                
                const isActive = mobileOverlay.classList.contains('active');
                
                if (isActive) {
                    mobileOverlay.classList.remove('active');
                    mobileToggle.classList.remove('active');
                    document.body.classList.remove('mobile-menu-active');
                    document.body.style.overflow = '';
                    console.log('üì± Menu closed');
                } else {
                    mobileOverlay.classList.add('active');
                    mobileToggle.classList.add('active');
                    document.body.classList.add('mobile-menu-active');
                    document.body.style.overflow = 'hidden';
                    console.log('üì± Menu opened');
                }
            });
        }
        
        if (mobileClose && mobileOverlay) {
            mobileClose.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('üì± Mobile menu close clicked!');
                
                mobileOverlay.classList.remove('active');
                if (mobileToggle) mobileToggle.classList.remove('active');
                document.body.classList.remove('mobile-menu-active');
                document.body.style.overflow = '';
                console.log('üì± Menu closed via X');
            });
        }
        
        if (mobileOverlay) {
            mobileOverlay.addEventListener('click', function(e) {
                if (e.target === mobileOverlay) {
                    console.log('üì± Mobile overlay clicked!');
                    
                    mobileOverlay.classList.remove('active');
                    if (mobileToggle) mobileToggle.classList.remove('active');
                    document.body.classList.remove('mobile-menu-active');
                    document.body.style.overflow = '';
                    console.log('üì± Menu closed via overlay');
                }
            });
        }
        
        // Desktop dropdown backup
        const dropdownTrigger = document.querySelector('.dropdown-trigger');
        const dropdownMenu = document.querySelector('.dropdown-menu-enhanced');
        const navDropdown = document.querySelector('.nav-dropdown');
        
        if (navDropdown && dropdownMenu && window.innerWidth >= 992) {
            console.log('üñ•Ô∏è Desktop dropdown initialized');
            
            navDropdown.addEventListener('mouseenter', function() {
                if (window.innerWidth >= 992) {
                    dropdownMenu.style.display = 'block';
                    dropdownMenu.classList.add('show');
                    console.log('üñ•Ô∏è Dropdown shown');
                }
            });
            
            navDropdown.addEventListener('mouseleave', function() {
                if (window.innerWidth >= 992) {
                    setTimeout(function() {
                        if (!navDropdown.matches(':hover') && !dropdownMenu.matches(':hover')) {
                            dropdownMenu.classList.remove('show');
                            dropdownMenu.style.display = 'none';
                            console.log('üñ•Ô∏è Dropdown hidden');
                        }
                    }, 300);
                }
            });
        }
        
        console.log('üîß Backup Mobile Menu Script - Ready!');
    });
    </script>
</body>
</html>
